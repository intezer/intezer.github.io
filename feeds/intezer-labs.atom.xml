<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Intezer</title><link href="blog.intezer.com/" rel="alternate"></link><link href="blog.intezer.com/feeds/intezer-labs.atom.xml" rel="self"></link><id>blog.intezer.com/</id><updated>2016-06-16T12:14:00+03:00</updated><entry><title>How to Defend Against IRONGATE-like malware?</title><link href="blog.intezer.com/how-to-defend-against-irongate-like-malware" rel="alternate"></link><published>2016-06-16T12:14:00+03:00</published><author><name>Intezer Labs</name></author><id>tag:,2016-06-16:blog.intezer.com/how-to-defend-against-irongate-like-malware</id><summary type="html">&lt;p&gt;&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;meta name="description" content="Python Malware"&gt;
&lt;meta name="keywords" content="python, python malware, pyinstaller, yara signatures, malware analysis, malware, virustotal, fireeye, irongate, irongate malware"&gt;
&lt;meta name="author" content="Intezer"&gt;
&lt;/head&gt;
&lt;strong&gt;How to Defend Against IRONGATE-like malware?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A lot of the recent buzz in the InfoSec community was about the &lt;a href="https://www.fireeye.com/blog/threat-research/2016/06/irongate_ics_malware.html"&gt;IRONGATE malware&lt;/a&gt;. IRONGATE was recently discovered by &lt;a href="https://www.fireeye.com/"&gt;FireEye&lt;/a&gt; while hunting for PyInstaller-crafted executables in &lt;a href="https://www.virustotal.com/"&gt;VirusTotal&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.pyinstaller.org/"&gt;PyInstaller&lt;/a&gt; is a program that converts Python scripts into stand-alone executables under Windows, Linux, and more. Due to the simplicity of Python development and the easy deployment of Python programs enabled by PyInstaller, malware authors are able to write sophisticated malware in no time.&lt;/p&gt;
&lt;p&gt;But how can we defend against these kind of threats?
We need to perform the following steps:&lt;/p&gt;
&lt;ol style="margin-left:20px;"&gt;
  &lt;li&gt;1. Identify PyInstaller executables&lt;/li&gt;
  &lt;li&gt;2. Analyze the PyInstaller executable by reviewing its original Python script code&lt;/li&gt;
  &lt;li&gt;3. Remediate according to the specific threat found&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;Identifying PyInstaller Executables&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There's a YARA signature created by &lt;a href="https://blog.didierstevens.com/"&gt; Didier Stevens&lt;/a&gt; that can be used in either an automatic or a manual mode to detect PyInstaller files. This signature basically looks for a specific string which is unique to PyInstaller-crafted executables.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/Yara-Rules/rules/blob/master/malware/pyinstaller.yar"&gt;PyInstaller Yara Signature&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Analyzing The PyInstaller Executable&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To deal with PyInstaller files, we can extract the original Python source code from any PyInstaller file and then analyze the code to get an understanding about its purpose, maliciousness, and full threat potential.  &lt;/p&gt;
&lt;p&gt;Unlike other executable binaries, for which we need to perform disassembly and review hard-to-read assembly code in order to fully analyze them, the process of analysis using PyInstaller is usually simple and fast. It fully exposes the entire Python code, making it easy to read.&lt;/p&gt;
&lt;p&gt;Extracting the Python source code can be done by using the excellent &lt;a href="http://sourceforge.net/projects/pyinstallerextractor"&gt;pyinstxtractor project&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It is used by running the pyinstallerextractor script: &lt;strong&gt;python pyinstxtractor.py PYINSTALLER_TEST_FILE.exe&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now, in the directory where you run pyinstxtractor, you should have the Python source code available to you. The only thing left is to rapidly read the code and analyze what it's doing in your system.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Remediation&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Remediation for PyInstaller files is not especially different from any other cyber threats; it really depends on the security systems deployed in your organization, and the code of the threat itself.  &lt;/p&gt;
&lt;p&gt;If you need any assistance regarding a specific case, we would be happy to help -- just visit our &lt;a href="http://www.intezer.com"&gt;website&lt;/a&gt; or contact us via email at &lt;a href="contact@intezer.com"&gt;contact@intezer.com&lt;/a&gt;&lt;/p&gt;</summary></entry><entry><title>Docker IDA</title><link href="blog.intezer.com/docker-ida" rel="alternate"></link><published>2016-05-26T10:00:00+03:00</published><author><name>Intezer Labs</name></author><id>tag:,2016-05-26:blog.intezer.com/docker-ida</id><summary type="html">&lt;p&gt;&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;meta name="description" content="Docker IDA Large Scale Reverse Engineering"&gt;
&lt;meta name="keywords" content="docker-ida, docker, docker ida"&gt;
&lt;meta name="author" content="Intezer"&gt;
&lt;/head&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/intezer/docker-ida"&gt;&lt;strong&gt;Docker IDA&lt;/strong&gt;&lt;/a&gt; is an open-source tool used to make reverse engineering on a large-scale simpler and faster.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Thwarting Malware Threats – It’s Time to Stop Playing in the Sandbox&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Many companies contend with hundreds or thousands of suspicious malware threats per day. Current popular solutions for dealing with such threats are sandboxes or simplistic static analysis tools. These are insufficient most of the time. You can get inconsistent results about files, or, investigate a file with anti-VM or anti-debugging techniques that often lead to dead-ends. In most cases, it is necessary for a professional reverse engineer expert to manually analyze the code for deeper inspection and complex insights. On a large amount of files, this can be a slow process and not very cost-effective.&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/docker-ida-4.png" width="70%" alt="reverse engineering"/&gt;&lt;/p&gt;
&lt;p&gt;Reverse engineering can get you accurate results about a file, but it is very time-consuming. In the optimal scenario, the researcher would be able to go over all of the files. With the current available crop of reverse engineering tools such as &lt;a href="https://www.hex-rays.com/products/ida/"&gt;IDA Pro&lt;/a&gt; or &lt;a href="http://www.ollydbg.de/"&gt;Ollydbg&lt;/a&gt;, it is not simple to do that on a large scale. For example, if you try to execute thousands of files in a sandbox and you are able to filter 80% of the files, a reverse engineer still has to manually go through each and every one of those unfiltered files. Automating this deep analysis process would make a huge impact in the malware analysis world.&lt;/p&gt;
&lt;p&gt;Here is what the ideal solution would look like:&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/docker-ida-1.png" width="80%" alt="large scale reverse engineering"/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;So why hasn’t this process been scaled before?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Current reverse engineering tools are not designed to work on a large-scale. IDA, for example, has a resource-heavy GUI and the terminal GUI is very challenging to use and automate. You cannot easily deploy IDA, with &lt;a href="https://github.com/idapython"&gt;IDAPython&lt;/a&gt;, or Ollydbg, with &lt;a href="https://sourceforge.net/projects/odbgscript/files/English%20Version/"&gt;ODbgScript&lt;/a&gt;, instances to a cluster of servers in a simple manner, as many scripts, processes, and manual work would be involved. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Mass-Scale Malware Threats Needs a Mass-Scale Solution&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We, at &lt;a href="http://intezer.com"&gt;Intezer Labs&lt;/a&gt;, have developed just such a solution to this problem: &lt;strong&gt;Large-Scale Reverse Engineering&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Our Solution ‘Contains’ the Problem&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://intezer.com"&gt;Intezer Labs&lt;/a&gt; was inspired by a relatively new trend in software development that allows processing at scale: containers. Containers solve the problem of how to get software to run reliably when moved from one computing environment to another. One container can wrap up a piece of software in a complete file system that includes everything it needs to run. This can be very useful when moving software from a development environment to a test or production environment and for quick and large-scale deployment. Realizing that the container solution is consistent and reliable, we combine the power of containers with the power of reverse engineering – achieving our goal of large-scale reverse engineering.&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/docker-ida-2.png" width="80%" alt="large scale reverse engineering"/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Docker IDA Project&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We chose IDA as our preferred reverse engineering tool because it is the most powerful choice for many reverse engineers. We selected Docker as our container technology since it is the most supported and stable. &lt;/p&gt;
&lt;p&gt;There were many challenges in dockerizing IDA. For example, IDA was not designed to run at scale. Another challenge was getting all of the necessary libraries for Python, to be used with IDAPython, that we wanted to embed (i.e., &lt;a href="http://sark.readthedocs.io/en/latest/#"&gt;Sark&lt;/a&gt;) for easy automation development. With Docker IDA and the framework we created in hand, one could very easily create a docker image, deploy thousands of IDA instances, and have an automated reverse engineering experience.&lt;/p&gt;
&lt;p&gt;&lt;img src="/images/docker-ida-5.png" width="80%" alt="automated reverse engineering"/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;What can be done with Large-Scale Reverse Engineering?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Run scripts that can do things such as:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;ul&gt;
    &lt;li type="circle"&gt; Automated unpacking&lt;/li&gt;
    &lt;li type="circle"&gt; String de-obfuscation&lt;/li&gt;
    &lt;li type="circle"&gt; Fuzzing&lt;/li&gt;
    &lt;li type="circle"&gt; Checking for buffer overflow exploits&lt;/li&gt;
&lt;/ul&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;And, much more... all on a &lt;strong&gt;large scale!&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Proof of Concept&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In order to show you the power of Docker IDA, we made a proof of concept on a large amount of files. &lt;/p&gt;
&lt;p&gt;We made a script that counts the amount of calls per API function – according to the data it can give you the amount of calls for each “family” of APIs. For example, with the script, we would be able to know that a file has 40% calls to network functions, 30% to I/O functions, and 30% to cryptography functions. This is something that we could not do in any static tool or sandbox because we are not only checking the import table, but counting the amount of calls for each function which only a disassembler tool could accurately achieve.&lt;/p&gt;
&lt;p&gt;In fact, we gathered about 1 million malware samples from various online malware repositories. Next, we created a cluster with many Docker IDA instances. Then, we ran our script on our cluster of deployed Docker IDA containers. &lt;/p&gt;
&lt;p&gt;We got back the results in a short period of time, and now there are multiple ways to analyze the data and come to a useful conclusion.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Where can I get Docker IDA?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The Docker IDA project, including the Docker file with which you can build the Docker image, is available at &lt;a href="http://intezer.com"&gt;Intezer's&lt;/a&gt; GitHub repository. If any researcher or team wants to run an IDAPython script on a large amount of samples, they are most welcome to contact us. We have a cluster of IDA instances which are already up and running.&lt;/p&gt;
&lt;p&gt;Thanks for reading, and also a special thanks to &lt;a href="https://www.hex-rays.com/"&gt;Hex-Rays&lt;/a&gt; for creating IDA. We hope you find Docker IDA useful! &lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/intezer/docker-ida"&gt;Docker IDA GitHub Repository&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/intezer"&gt;Intezer GitHub Repository&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.intezer.com"&gt;http://www.intezer.com&lt;/a&gt;&lt;/p&gt;</summary></entry></feed>